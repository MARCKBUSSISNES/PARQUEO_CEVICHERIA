<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ü¶ê PARQUEO CEVICHER√çA</title>
<style>
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: url('121212.png') no-repeat center center fixed;
  background-size: cover;
  color: #fff;
  overflow-x: hidden;
}

header {
  text-align: center;
  background: rgba(0,0,0,0.8);
  padding: 20px;
  font-size: 2rem;
  color: gold;
  font-weight: bold;
  letter-spacing: 1px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.5);
}

.container {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}

.buttons {
  display: flex;
  gap: 40px;
  flex-wrap: wrap;
  justify-content: center;
  margin-bottom: 40px;
}

.buttons img {
  width: 160px;
  height: 160px;
  cursor: pointer;
  transition: transform 0.2s;
  border-radius: 20px;
  box-shadow: 0 0 20px rgba(255,215,0,0.4);
}
.buttons img:hover {
  transform: scale(1.1);
}

.listado {
  background: rgba(0,0,0,0.7);
  border-radius: 15px;
  padding: 20px;
  width: 90%;
  max-width: 600px;
  box-shadow: 0 0 20px rgba(255,215,0,0.2);
}

.listado h2 {
  text-align: center;
  color: gold;
  margin-bottom: 10px;
}

.item {
  display: flex;
  justify-content: space-between;
  background: rgba(255,255,255,0.1);
  padding: 10px;
  margin: 5px 0;
  border-radius: 10px;
  font-size: 1.2rem;
}

input {
  padding: 10px;
  width: 200px;
  border: none;
  border-radius: 10px;
  text-align: center;
  font-size: 1rem;
  margin-top: 10px;
}

#cerrarDia {
  background: gold;
  color: black;
  border: none;
  padding: 10px 20px;
  border-radius: 10px;
  font-weight: bold;
  cursor: pointer;
  margin-top: 20px;
  box-shadow: 0 0 15px rgba(255,215,0,0.4);
}
#cerrarDia:hover { background: #ffe066; }

.ticket {
  display: none;
  font-family: monospace;
  font-size: 14px;
  text-align: center;
}
</style>
</head>
<body>

<header>ü¶ê PARQUEO CEVICHER√çA</header>

<div class="container">
  <div class="buttons">
    <img src="CARRO.png" id="btnCarro" title="Ingresar Carro">
    <img src="MOTO.png" id="btnMoto" title="Ingresar Moto">
    <img src="SALIDA.png" id="btnSalida" title="Sacar Veh√≠culo">
  </div>

  <input type="text" id="codigoSalida" placeholder="Ingrese c√≥digo a sacar">

  <div class="listado">
    <h2>Veh√≠culos en Parqueo</h2>
    <div id="listaVehiculos"></div>
  </div>

  <button id="cerrarDia">CERRAR Y GENERAR REPORTE</button>
</div>

<div id="ticket" class="ticket"></div>

<script>
let registros = JSON.parse(localStorage.getItem('parqueo_registros') || '[]');
const lista = document.getElementById('listaVehiculos');
const ticketDiv = document.getElementById('ticket');

// Generar c√≥digo √∫nico
function generarCodigo() {
  let codigo;
  do { codigo = Math.floor(100000 + Math.random() * 900000); }
  while (registros.some(r => r.codigo === codigo));
  return codigo;
}

// Mostrar lista
function actualizarLista() {
  lista.innerHTML = '';
  registros.filter(r => !r.salida).forEach(r => {
    const icono = r.tipo === 'CARRO' ? 'üöó' : 'üèçÔ∏è';
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `<span>${icono} ${r.codigo}</span><span>${r.hora}</span>`;
    lista.appendChild(div);
  });
  localStorage.setItem('parqueo_registros', JSON.stringify(registros));
}
actualizarLista();

// Imprimir ticket t√©rmico
function imprimirTicket(contenido) {
  const vent = window.open('', '_blank', 'width=300,height=600');
  vent.document.write(`<pre style="font-family:monospace;text-align:center;font-size:14px;">${contenido}</pre>`);
  vent.print();
  vent.close();
}

// Ingreso veh√≠culo
function ingresar(tipo) {
  const codigo = generarCodigo();
  const fecha = new Date();
  const hora = fecha.toLocaleTimeString();
  const dia = fecha.toLocaleDateString();
  registros.push({ tipo, codigo, hora, dia, salida:false });
  localStorage.setItem('parqueo_registros', JSON.stringify(registros));

  const icono = tipo === 'CARRO' ? 'üöó' : 'üèçÔ∏è';
  const ticket = `
ü¶ê PARQUEO CEVICHER√çA
------------------------
Tipo: ${icono} ${tipo}
C√≥digo: ${codigo}
Fecha: ${dia}
Hora: ${hora}
------------------------
*POR FAVOR NO PIERDA ESTE DOCUMENTO*
`;
  imprimirTicket(ticket);
  actualizarLista();
}

// Salida veh√≠culo
function sacarVehiculo() {
  const codigo = document.getElementById('codigoSalida').value.trim();
  if (!codigo) return alert('Ingrese un c√≥digo.');
  const vehiculo = registros.find(r => r.codigo == codigo && !r.salida);
  if (!vehiculo) return alert('C√≥digo no encontrado.');

  vehiculo.salida = true;
  const total = vehiculo.tipo === 'CARRO' ? 10 : 5;
  const fecha = new Date();
  const horaSalida = fecha.toLocaleTimeString();
  vehiculo.horaSalida = horaSalida;
  vehiculo.total = total;
  localStorage.setItem('parqueo_registros', JSON.stringify(registros));

  const icono = vehiculo.tipo === 'CARRO' ? 'üöó' : 'üèçÔ∏è';
  const ticket = `
ü¶ê PARQUEO CEVICHER√çA
------------------------
Tipo: ${icono} ${vehiculo.tipo}
C√≥digo: ${vehiculo.codigo}
Entrada: ${vehiculo.hora}
Salida: ${horaSalida}
------------------------
Total a pagar: Q${total}.00
------------------------
*POR FAVOR NO PIERDA ESTE DOCUMENTO*
`;
  imprimirTicket(ticket);
  actualizarLista();
  document.getElementById('codigoSalida').value = '';
}

// Cierre del d√≠a
function cierreDia() {
  const vendidos = registros.filter(r => r.salida);
  const totalCarros = vendidos.filter(r => r.tipo==='CARRO').length;
  const totalMotos = vendidos.filter(r => r.tipo==='MOTO').length;
  const totalQ = vendidos.reduce((sum,r)=>sum+r.total,0);

  const ticket = `
ü¶ê PARQUEO CEVICHER√çA
===== CIERRE DEL D√çA =====
Carros: ${totalCarros}  x Q10 = Q${totalCarros*10}
Motos: ${totalMotos}  x Q5 = Q${totalMotos*5}
------------------------
TOTAL GENERAL: Q${totalQ}
------------------------
${new Date().toLocaleString()}
`;
  imprimirTicket(ticket);

  // Descargar PDF respaldo
  const blob = new Blob([ticket], { type: 'application/pdf' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `Cierre_Parqueo_${new Date().toLocaleDateString()}.pdf`;
  a.click();

  registros = [];
  localStorage.setItem('parqueo_registros', JSON.stringify(registros));
  actualizarLista();
}

// Eventos
document.getElementById('btnCarro').onclick = ()=>ingresar('CARRO');
document.getElementById('btnMoto').onclick = ()=>ingresar('MOTO');
document.getElementById('btnSalida').onclick = sacarVehiculo;
document.getElementById('cerrarDia').onclick = cierreDia;
</script>
</body>
</html>
