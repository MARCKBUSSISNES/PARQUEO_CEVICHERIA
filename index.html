<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ü¶ê PARQUEO CEVICHERIA ü¶ê</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: url('121212.png') center/cover no-repeat fixed;
    color: #fff;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
}
.container {
    width: 100%;
    padding: 20px;
    box-sizing: border-box;
}
h1 {
    text-align: center;
    font-size: 48px;
    margin-bottom: 20px;
}
button {
    cursor: pointer;
}
#ingreso {
    display: flex;
    justify-content: center;
    gap: 50px;
    margin-bottom: 30px;
}
#ingreso button {
    width: 250px;
    height: 250px;
    font-size: 36px;
    border: none;
    border-radius: 20px;
    background-color: #222;
    color: #fff;
    transition: transform 0.2s, background 0.2s;
}
#ingreso button:hover {
    transform: scale(1.05);
    background-color: #444;
}
#vehiculos {
    width: 90%;
    margin: 0 auto 20px auto;
    max-height: 400px;
    overflow-y: auto;
    border: 2px solid #fff;
    padding: 10px;
    border-radius: 15px;
    background-color: rgba(0,0,0,0.6);
}
.vehiculo-item {
    display: flex;
    justify-content: space-between;
    font-size: 28px;
    padding: 10px;
    border-bottom: 2px solid #fff;
    align-items: center;
}
input#codigoInput {
    display: block;
    width: 50%;
    margin: 20px auto;
    padding: 20px;
    font-size: 32px;
    border-radius: 15px;
    border: 2px solid #fff;
    text-align: center;
    background: rgba(0,0,0,0.5);
    color: #fff;
}
#cierreBtn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 120px;
    height: 120px;
    border: none;
    background: url('CIERREE.png') center/cover no-repeat;
    background-size: contain;
    cursor: pointer;
}
</style>
</head>
<body>
<div class="container">
<h1>ü¶ê PARQUEO CEVICHERIA ü¶ê</h1>

<div id="ingreso">
    <button id="btnCarro">CARRO</button>
    <button id="btnMoto">MOTO</button>
</div>

<div id="vehiculos"></div>

<input type="text" id="codigoInput" placeholder="Ingrese c√≥digo y presione ENTER">

<button id="cierreBtn" title="Cerrar Ventas"></button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// Manejo de datos
let vehiculos = JSON.parse(localStorage.getItem('vehiculos')) || [];
let codigosUsados = JSON.parse(localStorage.getItem('codigosUsados')) || [];
let ventas = JSON.parse(localStorage.getItem('ventas')) || [];

// Generar c√≥digo aleatorio sin repetir
function generarCodigo() {
    let codigo;
    do { codigo = Math.floor(1000 + Math.random() * 9000); } 
    while (codigosUsados.includes(codigo));
    codigosUsados.push(codigo);
    localStorage.setItem('codigosUsados', JSON.stringify(codigosUsados));
    return codigo;
}

// Mostrar veh√≠culos ingresados
function actualizarListado() {
    const cont = document.getElementById('vehiculos');
    cont.innerHTML = '';
    vehiculos.forEach(v=>{
        const div = document.createElement('div');
        div.classList.add('vehiculo-item');
        div.innerHTML = `<span>${v.simbolo}</span><span>${v.codigo}</span><span>${v.hora}</span>`;
        cont.appendChild(div);
    });
}
actualizarListado();

// Funci√≥n de impresi√≥n de ticket grande
function imprimirTicket(codigo, simbolo, hora, tipo, ingreso=true){
    const ticketHTML = `
        <div style="width:280px; padding:30px; text-align:center; font-family:monospace;">
            <h1 style="font-size:36px; margin-bottom:20px;">ü¶ê PARQUEO CEVICHER√çA ü¶ê</h1>
            <p style="font-size:32px; margin:10px;">${simbolo}</p>
            <p style="font-size:32px; margin:10px;">C√≥digo: <strong>${codigo}</strong></p>
            <p style="font-size:32px; margin:10px;">Hora: <strong>${hora}</strong></p>
            ${!ingreso?`<p style="font-size:32px; margin:10px;">Tarifa: Q${tipo==='CARRO'?10:5}.00</p>`:''}
            <p style="font-size:24px; margin-top:20px;">*POR FAVOR NO PIERDA ESTE DOCUMENTO*</p>
        </div>
    `;
    const win = window.open('', '_blank', 'width=350,height=700');
    win.document.write(ticketHTML);
    win.document.close();
    win.focus();
    win.print();
    win.close();
}

// Ingresar veh√≠culos
function ingresarVehiculo(tipo){
    const hora = new Date().toLocaleTimeString();
    const fecha = new Date().toLocaleDateString();
    const codigo = generarCodigo();
    const simbolo = tipo==='CARRO'?'üöó':'üèçÔ∏è';
    vehiculos.push({codigo, simbolo, hora, tipo});
    localStorage.setItem('vehiculos', JSON.stringify(vehiculos));
    actualizarListado();
    imprimirTicket(codigo, simbolo, hora, tipo, true);
    document.getElementById('codigoInput').focus();
}

document.getElementById('btnCarro').addEventListener('click', ()=>ingresarVehiculo('CARRO'));
document.getElementById('btnMoto').addEventListener('click', ()=>ingresarVehiculo('MOTO'));

// Cobrar al presionar ENTER en la barra de c√≥digo
document.getElementById('codigoInput').addEventListener('keydown', (e)=>{
    if(e.key==='Enter'){
        const input = document.getElementById('codigoInput');
        const codigo = parseInt(input.value);
        const index = vehiculos.findIndex(v=>v.codigo===codigo);
        if(index!==-1){
            const veh = vehiculos[index];
            const horaSalida = new Date().toLocaleTimeString();
            imprimirTicket(veh.codigo, veh.simbolo, horaSalida, veh.tipo, false);
            ventas.push({tipo:veh.tipo, codigo:veh.codigo, hora:veh.hora, horaSalida});
            vehiculos.splice(index,1);
            localStorage.setItem('vehiculos', JSON.stringify(vehiculos));
            localStorage.setItem('ventas', JSON.stringify(ventas));
            actualizarListado();
            input.value = '';
        } else alert('C√≥digo no encontrado');
    }
});

// Cierre de ventas en PDF
document.getElementById('cierreBtn').addEventListener('click', ()=>{
    if(vehiculos.length>0){ alert('No puede cerrar, a√∫n hay veh√≠culos dentro'); return;}
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(18);
    doc.text("ü¶ê PARQUEO CEVICHERIA ü¶ê", 20, 20);
    let y = 40;
    let total = 0;
    let carros = 0, motos = 0;
    ventas.forEach(v=>{
        const tarifa = v.tipo==='CARRO'?10:5;
        total += tarifa;
        if(v.tipo==='CARRO') carros++; else motos++;
        doc.text(`${v.simbolo} C√≥digo: ${v.codigo} Entrada: ${v.hora} Salida: ${v.horaSalida} Q${tarifa}`, 10, y);
        y+=10;
        if(y>280){ doc.addPage(); y=20; }
    });
    doc.text(`\nTotal Carros: ${carros}\nTotal Motos: ${motos}\nTotal Recaudado: Q${total}`, 10, y+10);
    doc.save('Cierre_Parqueo.pdf');
    ventas = [];
    localStorage.setItem('ventas', JSON.stringify(ventas));
    codigosUsados = [];
    localStorage.setItem('codigosUsados', JSON.stringify(codigosUsados));
    alert('Cierre realizado y respaldado en PDF');
});
</script>
</body>
</html>
